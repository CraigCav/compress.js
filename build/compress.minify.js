(function(global,factory){if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof exports!=="undefined"){factory()}else{var mod={exports:{}};factory();global.compress=mod.exports}})(this,function(){"use strict";(function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)})([function(a,b,c){var d,e,f;(function(g,j){e=[b,c(1),c(2),c(3),c(4),c(5)],d=j,f="function"==typeof d?d.apply(b,e):d,!(f!==void 0&&(a.exports=f));var k})(this,function(g,j,k,l,m,n){"use strict";function o(v){return v&&v.__esModule?v:{default:v}}function p(v){if(Array.isArray(v)){for(var x=0,y=Array(v.length);x<v.length;x++)y[x]=v[x];return y}return Array.from(v)}Object.defineProperty(g,"__esModule",{value:!0});var q=o(j),r=o(k),s=o(l),t=o(m),u=o(n);g.default=function(){function x(B,C){return Promise.all(B.map(function(D){return y(D,C)}))}function y(B,C){var D=new u.default(C);return D.start=performance.now(),D.alt=B.name,D.ext=B.type,D.startSize=B.size,s.default.load(B).then(z(D))}function z(B){return function(C){return t.default.load(C).then(function(D){if(B.startWidth=D.naturalWidth,B.startHeight=D.naturalHeight,B.resize){var E=t.default.resize(B.maxWidth,B.maxHeight)(D.naturalWidth,D.naturalHeight),F=E.width,G=E.height;B.endWidth=F,B.endHeight=G}else B.endWidth=D.naturalWidth,B.endHeight=D.naturalHeight;return r.default.imageToCanvas(B.endWidth,B.endHeight)(D)}).then(function(D){return B.iterations=1,B.base64prefix=q.default.prefix(q.default.mime(r.default.canvasToBase64(D))),A(D,B.startSize,B.quality,B.size,B.minQuality,B.iterations)}).then(function(D){return B.finalSize=q.default.size(D),q.default.data(D)}).then(function(D){B.end=performance.now();var E=B.end-B.start;return{data:D,timeElapsedInSeconds:E/1000,alt:B.alt,startSizeInMB:r.default.size(B.startSize).MB,base64prefix:B.base64prefix,finalSizeInMB:r.default.size(B.finalSize).MB,ext:B.ext,quality:B.quality,endWidthInPX:B.endWidth,endHeightInPX:B.endHeight,startWidthInPX:B.startWidth,startHeightInPX:B.startHeight,sizeReducedInPercent:100*((B.startSize-B.finalSize)/B.startSize),iterations:B.iterations}})}}function A(B){var C=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,D=arguments[3],E=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,F=arguments[5],G=r.default.canvasToBase64(B),H=q.default.size(G);return F+=1,H>D?A(B,H,C-0.1,E,D,F):C>E?A(B,H,C-0.1,E,D,F):0.5>C?G:G}return{compress:x,attach:function attach(C,D){return new Promise(function(E){var F=document.querySelector(C);F.setAttribute("accept","image/*"),F.addEventListener("change",function(G){var H=x([].concat(p(G.target.files)),D);E(H)},!1)})}}}})},function(a,b){var c,d,e;(function(f,g){d=[b],c=g,e="function"==typeof c?c.apply(b,d):c,!(e!==void 0&&(a.exports=e));var j})(this,function(f){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.default={size:function size(j){var k=j.replace(/^data:image\/\w+;base64,/,"").length;return(k-814)/1.37},mime:function mime(j){return j.split(";")[0].match(/jpeg|png|gif/)[0]},data:function data(j){return j.replace(/^data:image\/\w+;base64,/,"")},prefix:function prefix(j){return"data:"+j+";base64,"}}})},function(a,b){var c,d,e;(function(f,g){d=[b],c=g,e="function"==typeof c?c.apply(b,d):c,!(e!==void 0&&(a.exports=e));var j})(this,function(f){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.default={base64ToFile:function base64ToFile(j){var k=window.atob(j),l=[];for(var m=0;m<k.length;m++)l[m]=k.charCodeAt(m);return new window.Blob([new Uint8Array(l)],{type:"image/jpeg"})},imageToCanvas:function imageToCanvas(j,k){var l=document.createElement("canvas");return l.width=j,l.height=k,function(m){var n=l.getContext("2d");return n.drawImage(m,0,0,l.width,l.height),l}},canvasToBase64:function canvasToBase64(j){var k=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0.75,l=j.toDataURL("image/jpeg",k);return l},size:function size(j){return{KB:j/1000,MB:j/1000000}}}})},function(a,b){var c,d,e;(function(f,g){d=[b],c=g,e="function"==typeof c?c.apply(b,d):c,!(e!==void 0&&(a.exports=e));var j})(this,function(f){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.default={load:function load(j){return new Promise(function(k,l){var m=new FileReader;m.addEventListener("load",function(n){k(n.target.result)},!1),m.addEventListener("error",function(n){l(n)},!1),m.readAsDataURL(j)})}}})},function(a,b){var c,d,e;(function(f,g){d=[b],c=g,e="function"==typeof c?c.apply(b,d):c,!(e!==void 0&&(a.exports=e));var j})(this,function(f){"use strict";Object.defineProperty(f,"__esModule",{value:!0}),f.default={load:function load(j){return new Promise(function(k,l){var m=new Image;m.addEventListener("load",function(){k(m)},!1),m.addEventListener("error",function(n){l(n)},!1),m.src=j})},resize:function resize(j,k){return function(l,m){if(!j&&!k)return{width:l,height:m};var n=Math.min(l,j),o=Math.min(m,k);return n?{width:n,height:m/(l/n)}:{width:l/(m/o),height:o}}}}})},function(a,b){var c,d,e;(function(f,g){d=[b],c=g,e="function"==typeof c?c.apply(b,d):c,!(e!==void 0&&(a.exports=e));var j})(this,function(f){"use strict";function g(j,k){if(!(j instanceof k))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(f,"__esModule",{value:!0}),f.default=function j(k){var l=k.quality,m=l===void 0?0.75:l,n=k.size,o=n===void 0?2:n,p=k.maxWidth,q=p===void 0?1920:p,r=k.maxHeight,s=r===void 0?1920:r,t=k.resize,u=!(t!==void 0)||t;g(this,j),this.start=performance.now(),this.end=null,this.alt=null,this.ext=null,this.startSize=null,this.startWidth=null,this.startHeight=null,this.size=1000*(1000*o),this.endSize=null,this.endWidth=null,this.endHeight=null,this.iterations=0,this.base64prefix=null,this.quality=m,this.resize=u,this.maxWidth=q,this.maxHeight=s}})}])});
